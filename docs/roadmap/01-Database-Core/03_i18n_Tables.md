# üåç i18n Tables

> **Internationalization tablolarƒ±: Currencies, Exchange Rates, Languages, Translations**

[‚óÄÔ∏è Geri: Core Database Schema](02_Core_Database_Schema.md) | [Ana Sayfa](README.md) | [ƒ∞leri: RLS Strategy ‚ñ∂Ô∏è](04_RLS_Multi_Tenant_Strategy.md)

---

## üìã ƒ∞√ßindekiler

1. [cfg.currencies - Para Birimleri](#1-cfgcurrencies---para-birimleri)
2. [cfg.exchange_rates - D√∂viz Kurlarƒ±](#2-cfgexchange_rates---d√∂viz-kurlarƒ±)
3. [cfg.languages - Diller](#3-cfglanguages---diller)
4. [cfg.translations - √áeviriler](#4-cfgtranslations---√ßeviriler)

---

## 1. cfg.currencies - Para Birimleri

### Tablo Tanƒ±mƒ±

```sql
CREATE TABLE cfg.currencies (
  code VARCHAR(3) PRIMARY KEY,  -- ISO 4217: USD, EUR, TRY
  name VARCHAR(100) NOT NULL,
  symbol VARCHAR(10) NOT NULL,  -- $, ‚Ç¨, ‚Ç∫
  decimal_digits INTEGER DEFAULT 2,
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_currencies_active ON cfg.currencies(is_active);
```

### Seed Data (Default Currencies)

```sql
INSERT INTO cfg.currencies (code, name, symbol, decimal_digits) VALUES
('USD', 'US Dollar', '$', 2),
('EUR', 'Euro', '‚Ç¨', 2),
('TRY', 'Turkish Lira', '‚Ç∫', 2),
('GBP', 'British Pound', '¬£', 2),
('JPY', 'Japanese Yen', '¬•', 0),
('CNY', 'Chinese Yuan', '¬•', 2),
('SAR', 'Saudi Riyal', 'SR', 2),
('AED', 'UAE Dirham', 'AED', 2),
('RUB', 'Russian Ruble', '‚ÇΩ', 2),
('INR', 'Indian Rupee', '‚Çπ', 2),
('BRL', 'Brazilian Real', 'R$', 2),
('CAD', 'Canadian Dollar', 'C$', 2)
ON CONFLICT (code) DO NOTHING;
```

### Desteklenen Para Birimleri

| Kod | Para Birimi | Sembol | Ondalƒ±k | B√∂lge |
|-----|-------------|--------|---------|-------|
| USD | US Dollar | $ | 2 | Global |
| EUR | Euro | ‚Ç¨ | 2 | Europe |
| TRY | Turkish Lira | ‚Ç∫ | 2 | Turkey |
| GBP | British Pound | ¬£ | 2 | UK |
| JPY | Japanese Yen | ¬• | 0 | Japan |
| CNY | Chinese Yuan | ¬• | 2 | China |
| SAR | Saudi Riyal | SR | 2 | Saudi Arabia |
| AED | UAE Dirham | AED | 2 | UAE |
| RUB | Russian Ruble | ‚ÇΩ | 2 | Russia |
| INR | Indian Rupee | ‚Çπ | 2 | India |
| BRL | Brazilian Real | R$ | 2 | Brazil |
| CAD | Canadian Dollar | C$ | 2 | Canada |

---

## 2. cfg.exchange_rates - D√∂viz Kurlarƒ±

### Tablo Tanƒ±mƒ±

```sql
CREATE TABLE cfg.exchange_rates (
  id GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  from_currency VARCHAR(3) NOT NULL REFERENCES cfg.currencies(code),
  to_currency VARCHAR(3) NOT NULL REFERENCES cfg.currencies(code),
  rate NUMERIC(20, 6) NOT NULL,
  rate_date DATE NOT NULL DEFAULT CURRENT_DATE,
  source VARCHAR(50) DEFAULT 'manual',  -- 'manual', 'tcmb', 'ecb', 'api'
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT unique_rate_per_day UNIQUE (from_currency, to_currency, rate_date)
);

CREATE INDEX idx_exchange_rates_from ON cfg.exchange_rates(from_currency);
CREATE INDEX idx_exchange_rates_to ON cfg.exchange_rates(to_currency);
CREATE INDEX idx_exchange_rates_date ON cfg.exchange_rates(rate_date);
CREATE INDEX idx_exchange_rates_pair ON cfg.exchange_rates(from_currency, to_currency, rate_date);
```

### Exchange Rate Kaynaklarƒ±

| Source | A√ßƒ±klama | URL |
|--------|----------|-----|
| `manual` | Manuel giri≈ü | - |
| `tcmb` | T.C. Merkez Bankasƒ± | https://www.tcmb.gov.tr/ |
| `ecb` | European Central Bank | https://www.ecb.europa.eu/ |
| `api` | Otomatik API (currencyapi.com) | https://currencyapi.com/ |
| `bank` | Banka kurlarƒ± | - |

### Otomatik Kur G√ºncelleme

```javascript
// Node.js - TCMB'den kur √ßekme
async function updateExchangeRates() {
  const response = await fetch('https://www.tcmb.gov.tr/kurlar/today.xml');
  const xml = await response.text();
  
  // XML parse et
  const rates = parseXML(xml);
  
  for (const rate of rates) {
    await pool.query(`
      INSERT INTO cfg.exchange_rates (from_currency, to_currency, rate, source, rate_date)
      VALUES ('TRY', $1, $2, 'tcmb', CURRENT_DATE)
      ON CONFLICT (from_currency, to_currency, rate_date) 
      DO UPDATE SET rate = $2, updated_at = CURRENT_TIMESTAMP
    `, [rate.currency, rate.value]);
  }
}

// Cron job - Her g√ºn 15:30'da √ßalƒ±≈üƒ±r
cron.schedule('30 15 * * *', updateExchangeRates);
```

---

## 3. cfg.languages - Diller

### Tablo Tanƒ±mƒ±

```sql
CREATE TABLE cfg.languages (
  code VARCHAR(10) PRIMARY KEY,  -- ISO 639-1: en, tr, ar
  name VARCHAR(100) NOT NULL,
  native_name VARCHAR(100) NOT NULL,  -- English, T√ºrk√ße, ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
  direction VARCHAR(3) DEFAULT 'ltr',  -- 'ltr' or 'rtl'
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_languages_active ON cfg.languages(is_active);
```

### Seed Data (Default Languages)

```sql
INSERT INTO cfg.languages (code, name, native_name, direction) VALUES
('en', 'English', 'English', 'ltr'),
('tr', 'Turkish', 'T√ºrk√ße', 'ltr'),
('ar', 'Arabic', 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©', 'rtl'),
('es', 'Spanish', 'Espa√±ol', 'ltr'),
('fr', 'French', 'Fran√ßais', 'ltr'),
('de', 'German', 'Deutsch', 'ltr'),
('zh', 'Chinese', '‰∏≠Êñá', 'ltr'),
('ru', 'Russian', '–†—É—Å—Å–∫–∏–π', 'ltr'),
('ja', 'Japanese', 'Êó•Êú¨Ë™û', 'ltr'),
('pt', 'Portuguese', 'Portugu√™s', 'ltr'),
('it', 'Italian', 'Italiano', 'ltr'),
('nl', 'Dutch', 'Nederlands', 'ltr')
ON CONFLICT (code) DO NOTHING;
```

### Desteklenen Diller

| Kod | Dil | Native | Y√∂n | Kullanƒ±cƒ± Sayƒ±sƒ± (Global) |
|-----|-----|--------|-----|---------------------------|
| en | English | English | LTR | 1.5B |
| zh | Chinese | ‰∏≠Êñá | LTR | 1.1B |
| es | Spanish | Espa√±ol | LTR | 500M |
| ar | Arabic | ÿßŸÑÿπÿ±ÿ®Ÿäÿ© | RTL | 420M |
| fr | French | Fran√ßais | LTR | 280M |
| de | German | Deutsch | LTR | 130M |
| tr | Turkish | T√ºrk√ße | LTR | 80M |
| ru | Russian | –†—É—Å—Å–∫–∏–π | LTR | 260M |
| ja | Japanese | Êó•Êú¨Ë™û | LTR | 125M |
| pt | Portuguese | Portugu√™s | LTR | 235M |
| it | Italian | Italiano | LTR | 85M |
| nl | Dutch | Nederlands | LTR | 25M |

### RTL (Right-to-Left) Support

**RTL Diller:**
- Arabic (ar) - ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
- Hebrew (he) - ◊¢◊ë◊®◊ô◊™
- Persian (fa) - ŸÅÿßÿ±ÿ≥€å
- Urdu (ur) - ÿßÿ±ÿØŸà

**Frontend CSS:**
```css
[dir="rtl"] {
  direction: rtl;
  text-align: right;
}

[dir="rtl"] .container {
  flex-direction: row-reverse;
}
```

---

## 4. cfg.translations - √áeviriler

### Tablo Tanƒ±mƒ±

```sql
CREATE TABLE cfg.translations (
  id GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  tenant_id INTEGER REFERENCES core.tenants(id) ON DELETE CASCADE,
  language_code VARCHAR(10) NOT NULL REFERENCES cfg.languages(code),
  translation_key VARCHAR(200) NOT NULL,  -- 'common.welcome', 'product.name'
  translation_value TEXT NOT NULL,
  context VARCHAR(100),  -- 'frontend', 'backend', 'email'
  created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT unique_translation UNIQUE (tenant_id, language_code, translation_key)
);

CREATE INDEX idx_translations_tenant ON cfg.translations(tenant_id);
CREATE INDEX idx_translations_language ON cfg.translations(language_code);
CREATE INDEX idx_translations_key ON cfg.translations(translation_key);
CREATE INDEX idx_translations_context ON cfg.translations(context);
```

### Translation Key Naming Convention

```
<scope>.<entity>.<field>

√ñrnekler:
- common.welcome
- common.save
- common.cancel
- product.name
- product.price
- product.add_to_cart
- order.total
- order.shipping_address
- user.profile
- user.settings
```

### √ñrnek Veriler

```sql
-- English translations
INSERT INTO cfg.translations (tenant_id, language_code, translation_key, translation_value, context) VALUES
(1, 'en', 'common.welcome', 'Welcome', 'frontend'),
(1, 'en', 'common.save', 'Save', 'frontend'),
(1, 'en', 'common.cancel', 'Cancel', 'frontend'),
(1, 'en', 'product.name', 'Product Name', 'frontend'),
(1, 'en', 'product.price', 'Price', 'frontend'),
(1, 'en', 'product.add_to_cart', 'Add to Cart', 'frontend');

-- Turkish translations
INSERT INTO cfg.translations (tenant_id, language_code, translation_key, translation_value, context) VALUES
(1, 'tr', 'common.welcome', 'Ho≈ü Geldiniz', 'frontend'),
(1, 'tr', 'common.save', 'Kaydet', 'frontend'),
(1, 'tr', 'common.cancel', 'ƒ∞ptal', 'frontend'),
(1, 'tr', 'product.name', '√úr√ºn Adƒ±', 'frontend'),
(1, 'tr', 'product.price', 'Fiyat', 'frontend'),
(1, 'tr', 'product.add_to_cart', 'Sepete Ekle', 'frontend');

-- Arabic translations
INSERT INTO cfg.translations (tenant_id, language_code, translation_key, translation_value, context) VALUES
(1, 'ar', 'common.welcome', 'ŸÖÿ±ÿ≠ÿ®ÿß', 'frontend'),
(1, 'ar', 'common.save', 'ÿ≠ŸÅÿ∏', 'frontend'),
(1, 'ar', 'common.cancel', 'ÿ•ŸÑÿ∫ÿßÿ°', 'frontend'),
(1, 'ar', 'product.name', 'ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÜÿ™ÿ¨', 'frontend'),
(1, 'ar', 'product.price', 'ÿßŸÑÿ≥ÿπÿ±', 'frontend'),
(1, 'ar', 'product.add_to_cart', 'ÿ£ÿ∂ŸÅ ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿ©', 'frontend');
```

### Translation Helper Functions

```javascript
// Node.js - Translation helper
class TranslationService {
  async getTranslation(tenantId, languageCode, key, defaultValue = null) {
    const result = await pool.query(`
      SELECT translation_value FROM cfg.translations
      WHERE tenant_id = $1 AND language_code = $2 AND translation_key = $3
    `, [tenantId, languageCode, key]);
    
    return result.rows[0]?.translation_value || defaultValue || key;
  }
  
  async getAllTranslations(tenantId, languageCode) {
    const result = await pool.query(`
      SELECT translation_key, translation_value 
      FROM cfg.translations
      WHERE tenant_id = $1 AND language_code = $2
    `, [tenantId, languageCode]);
    
    return result.rows.reduce((acc, row) => {
      acc[row.translation_key] = row.translation_value;
      return acc;
    }, {});
  }
  
  async setTranslation(tenantId, languageCode, key, value, context = 'frontend') {
    await pool.query(`
      INSERT INTO cfg.translations 
        (tenant_id, language_code, translation_key, translation_value, context)
      VALUES ($1, $2, $3, $4, $5)
      ON CONFLICT (tenant_id, language_code, translation_key)
      DO UPDATE SET 
        translation_value = $4, 
        context = $5,
        updated_at = CURRENT_TIMESTAMP
    `, [tenantId, languageCode, key, value, context]);
  }
}
```

### API Usage

```javascript
// GET /api/v1/translations?language=tr
GET /api/v1/translations
Headers: {
  "Accept-Language": "tr"
}

Response:
{
  "common.welcome": "Ho≈ü Geldiniz",
  "common.save": "Kaydet",
  "product.name": "√úr√ºn Adƒ±",
  ...
}

// POST /api/v1/translations
POST /api/v1/translations
{
  "language": "tr",
  "translations": {
    "custom.button": "√ñzel Buton",
    "custom.message": "√ñzel Mesaj"
  }
}
```

---

## üîó ƒ∞lgili D√∂k√ºmanlar

- [02_Core_Database_Schema.md](02_Core_Database_Schema.md) - core.tenants (default_language, default_currency)
- [07_i18n_Localization.md](07_i18n_Localization.md) - Currency/language management detaylarƒ±
- [05_Template_System.md](05_Template_System.md) - Template'lerde i18n desteƒüi

---

**[‚óÄÔ∏è Geri: Core Database Schema](02_Core_Database_Schema.md) | [Ana Sayfa](README.md) | [ƒ∞leri: RLS Strategy ‚ñ∂Ô∏è](04_RLS_Multi_Tenant_Strategy.md)**

